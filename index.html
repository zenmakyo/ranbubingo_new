<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>乱舞ビンゴ</title>
  <link href="https://fonts.googleapis.com/css2?family=Zen+Kurenaido&display=swap" rel="stylesheet">
  <style>
    body {
      background-color: #98AB6F;
      margin: 0;
      font-family: sans-serif;
      text-align: center;
    }
    h1 {
      font-family: 'Zen Kurenaido', sans-serif;
      font-size: 3.5rem;
      color: white;
      -webkit-text-stroke: 3px black;
      paint-order: stroke fill;
      font-weight: bold;
      padding: 0.5rem;
      line-height: 1.1;
    }
    table {
      width: 90vmin;
      height: 90vmin;
      margin: auto;
      border-collapse: collapse;
      table-layout: fixed;
    }
    td {
      border: 2px solid #2e4e1e;
      aspect-ratio: 1 / 1;
      position: relative;
      background-color: #ccc;
    }
    .free-cell {
      background-image: url("rainbowranbu.png");
      background-size: cover;
      background-position: center;
      background-repeat: no-repeat;
      background-color: #f5f5dc;
    }
    .cell-content {
      width: 100%;
      height: 100%;
      display: flex;
      align-items: center;
      justify-content: center;
      padding: 5%;
      box-sizing: border-box;
      position: relative;
    }
    .cell-input {
  width: 85%;
  height: 85%;
  box-sizing: border-box;
  font-size: 2.5vmin;
  text-align: center;
  position: relative;
  
  /* ↓↓ テキストエリア用のスタイル調整 ↓↓ */
  resize: none;             /* サイズ変更を無効にする */
  overflow-wrap: break-word;/* 単語途中でも折り返す */
  word-break: break-word;   /* 単語途中でも折り返す（追加で確実に） */
  overflow: hidden;         /* はみ出した部分は隠す */
  white-space: pre-wrap;    /* 折り返しを許可（改行も保持、でもEnter無効にするからOK） */
}
    .suggestions {
      position: absolute;
      top: 90%;
      left: 50%;
      transform: translateX(-50%);
      width: 150%;
      max-height: 50vmin;
      overflow-y: auto;
      background-color: white;
      border: 1px solid #ccc;
      border-radius: 5px;
      z-index: 10;
      display: none;
      font-size: 2vmin;
    }
    .suggestions div {
      padding: 0.5rem;
      cursor: pointer;
    }
    .suggestions div:hover {
      background-color: #eee;
    }
    .button-container {
      margin-top: 1rem;
      display: flex;
      justify-content: center;
      gap: 1rem;
    }
    button {
      padding: 0.6rem 1.2rem;
      font-size: 1rem;
      border: none;
      border-radius: 8px;
      background-color: #2e4e1e;
      color: white;
      cursor: pointer;
    }
  </style>
</head>
<body>
  <h1>
  <span style="font-size: 2rem; ">第１回</span>
  <br>乱舞ビンゴ
  </h1>
  <table id="bingo">
    <tbody></tbody>
  </table>

  <div class="button-container">
    <button onclick="randomFill()">ランダム配置</button>
    <button onclick="resetBoard()">リセット</button>
  </div>

  <script>
    const wordList = [
  "ケロペン先生", "憤慨するタウマース", "ハマガイ", "ふにゃ渡し", "かぼプキン", "星ノ位・天秤の傍役", "カラマリン", "てる坊主", "スカディの傍役", "謎掛の悪戯猫の傍役",
  "甘言に従う者の傍役", "キーウィ", "パヨカムイ（Lv49)", "ストラプト", "ウシャマル", "グリモワール", "木霊里", "錬金術師ソフィアの傍役", "ガネーシャ", "丙申",
  "氷灯の隠者", "ペリタマ", "アプサラス", "星跳のティアミ", "ゴールデンゴーレム", "メタルゴーレム", "一言主", "探偵ショルメ", "ファットドラゴン", "ツドイガイ",
  "にゃぶぎょう", "赤い頭巾の娘・悲", "夢路の蠱術師", "激浪の略奪者", "森羅の後継者の傍役", "薛茘鬼の傍役", "明狐", "宵狐", "バステト", "呼福童",
  "デーモンローズ", "シャムシード", "タンクドラゴン", "天空鯨", "虹色の番竜", "カラフラウム", "ヒデリガミ", "不知火", "紅酒のポジョン", "夜色の番竜",
  "天女海月", "水母娘娘", "デスコーピオン", "海御前", "猿飛", "ジン", "鵺", "タナトス", "ドルチェ", "冬将軍ユキムネ",
  "ヘル", "点睛を欠く画龍", "烏天狗", "ココペリ", "蜃", "スキムドラゴン", "ノーム", "ベロニカの乙女", "フェダーイン", "紫怨万代朧車",
  "ルドラ", "高雅たる詠人", "ファラク", "ベルゼブル", "パッチワークドラゴン", "ミヅハノメ", "亡霊船フリゲート", "イセキモリ", "おみくじ小町【大吉】", "クラーケン",
  "パウチカムイ", "のっぺらぼう・正", "瘴谷の邪竜", "エレシュキガル", "小雪姫", "伏姫", "リャナンシー", "迦陵頻伽", "高潔なる選定者", "双生の群夜灯",
  "イーリス", "ケライノー", "グレモリー", "ファーミュ", "ルーガルー", "薬湯殿ゆ屋", "濡髪童子", "ヴィシュヌ", "ガルーダ", "イシス",
  "エクチュアフ", "牛魔神", "晴朗な明察者", "白翼のマーテル", "王家の末路", "シュバリエディオン", "祝膳女将【絶品】", "アルテミス", "シャイターン", "五十嵐・卍",
  "エル・ラドル", "怨毒宿せし亡王", "キョンシー", "シヴァ", "薄幸佳人【微妙かも】", "スサノオ", "導きの魔奏者", "ファントム", "パヨカムイ(Lv179)", "魔導要塞クレイドル",
  "皇竜", "謎掛の悪戯猫", "執金剛神", "陽翼神ラー", "ぬらりひょん【狂宴】", "クエイクドラゴン", "滅鬼積鬼", "甘言に従う者", "薛茘鬼", "影獅子",
  "アジダハーカ", "座天使", "なまはげ", "夢魔", "悪路王", "道を外れし者", "闇に囁く者", "名状しがたい者", "緑の深淵の女王", "星間を駆ける者",
  "獄星の千年花", "地を穿つ魔", "旧支配者の大祭司", "反魂竜", "破壊神", "渾沌", "饕餮", "窮奇", "難訓", "阿",
  "吽", "メデューサ", "エウリュアレ", "ステンノ", "創星神コスモ", "壊星神コスモ", "ロキ", "白澤", "禍津", "孟極",
  "アナト", "ヘイムダル", "アテナ", "アポロンα", "夢幻の胡蝶【正夢】", "獅子丸・護", "獅子丸・荒", "戦嵐ノ影獅子", "遅咲蝶", "オキクムシ",
  "鋼鉄オオヒラタ", "森羅の後継者", "花蟷フルルテス", "ネフティス", "白猪坊", "アルピィ", "コトノハミ", "時の腐肉喰らい", "ガランドーヴ", "壬寅",
  "鈴鹿御前", "ヴァイシュラヴァナ", "戦風の皇女", "幻綴司書アナムネシア", "スケイジー", "火鼠", "八咫烏", "天真娘メイメイ", "ジャックランタン", "召喚士テオの傍役",
  "グリムメアの傍役", "ノームの傍役", "小結きんたろう", "御使い", "柚子あひる【並】", "閻魔大女将", "ドン・ムグラ", "海幽魚ガッツゥーヲ", "千の仔を随えし黒山羊", "染乃撫子",
  "塵塚怪王", "灯髏鬼", "甘殻ヤドコロネ", "石川五右衛門", "アルセーヌ・ルパン", "錬金生命ポビルコ", "マンドラゴラ【喜】", "ネイト・トントゥ", "ヤンヤン・テイテイ", "揺蕩う白影（Lv200）", 
  "睡臥雲客", "ペインティール", "幻惑師・藍丸", "紅藍ノ朋", "常世の車掌ワダチ", "ハーラグゥ", "オトリコガネ", "鬼ヶ臼", "幻月に蔓延りし者", "宇迦之御魂神",
  "大国主", "シュクレッタ", "タケミカヅチ", "牛若丸", "彩海のシウミゥ", "百々目鬼", "荒くれ番長ラウディ", "晴天狐", "有頂天狐", "アルタ・テオカリル", 
  "アルタ・ナインハーツ", "アルタ・ニ・コヴァン", "エーヌシトルイユ", "這い寄る混沌", "闇の狂信者", 
  "ゴールド・G・ゴーレム", "シルバー・G・ゴーレム", "つちのこ",
  "ヴァンピール", "アフロディーテ", "玉姫", "バアルゼブル", "ハルモニア", "アスモデウス", "竜扇陽", "キュベレー", "ベリアル", "白兎神",
  "羅刹鬼", "魔術師マーリン", "霊騎士シルドラント", "闇竜", "聖竜", "黒陸吾", "熾天使", "ダークロードナイトメア", "玉藻前", "ニーズヘッグ", 
  "緋翼のアグシャナ", "フェンリル", "バハムート", "創造神", "月日を追う者", "スカサハ", "ベヒモス", "エレクトラ", "金鵄", "赫轟魔イフリート",
  "フレイヤ", "斉天大聖", "ティアマト", "乙姫", "ゲンペイボタル", "オキクルミ", "百花仙子"
];
    const rainbowWords = [
  "ヴァンピール", "アフロディーテ", "玉姫", "バアルゼブル", "ハルモニア", "アスモデウス", "竜扇陽", "キュベレー", "ベリアル", "白兎神",
  "羅刹鬼", "魔術師マーリン", "霊騎士シルドラント", "闇竜", "聖竜", "黒陸吾", "熾天使", "ダークロードナイトメア", "玉藻前", "ニーズヘッグ", 
  "緋翼のアグシャナ", "フェンリル", "バハムート", "創造神", "月日を追う者", "スカサハ", "ベヒモス", "エレクトラ", "金鵄", "赫轟魔イフリート",
  "フレイヤ", "斉天大聖", "ティアマト", "乙姫", "ゲンペイボタル", "オキクルミ", "百花仙子"
];
    const roseWord = [ "デーモンローズ" ];
    
    const usedWords = new Set();

    const table = document.querySelector("#bingo tbody");

    for (let row = 0; row < 5; row++) {
      const tr = document.createElement("tr");
      for (let col = 0; col < 5; col++) {
        const td = document.createElement("td");
        td.dataset.row = row;
        td.dataset.col = col;

        if (row === 2 && col === 2) {
          td.classList.add("free-cell");
        } else {
          const wrapper = document.createElement("div");
          wrapper.className = "cell-content";

          const input = document.createElement("textarea");
          input.className = "cell-input";
          input.setAttribute("placeholder", "未選択");
          input.setAttribute("rows", "1");           // 1行に見せかける（Enterで改行されないように）
          input.setAttribute("wrap", "soft");        // 折り返しを有効に
          input.addEventListener("keydown", e => {
          if (e.key === "Enter") e.preventDefault(); // Enter押下による改行防止
          });

          const suggestionBox = document.createElement("div");
          suggestionBox.className = "suggestions";

          input.addEventListener("focus", () => {
  updateSuggestions(input, suggestionBox);
  suggestionBox.style.display = "block";
});

// 👇 追加：変換確定時のみ候補を更新
input.addEventListener("compositionend", () => {
  updateSuggestions(input, suggestionBox);
});

input.addEventListener("blur", () => {
  setTimeout(() => suggestionBox.style.display = "none", 200);
});

          suggestionBox.addEventListener("mousedown", (e) => {
            if (e.target.tagName === "DIV") {
              const selected = e.target.textContent;
              if (usedWords.has(selected)) {
                alert("すでに使用されています！");
                return;
              }
              input.value = selected;
              suggestionBox.style.display = "none";
              finalizeInput(input, td, selected);
            }
          });

          input.addEventListener("change", () => {
            const val = input.value.trim();
            if (!wordList.includes(val)) {
              alert("このワードはリストにありません！");
              input.value = "";
              td.style.background = "#ccc";
              return;
            }
            if (usedWords.has(val)) {
              alert("すでに使用されています！");
              input.value = "";
              td.style.background = "#ccc";
              return;
            }
            finalizeInput(input, td, val);
          });

          wrapper.appendChild(input);
          wrapper.appendChild(suggestionBox);
          td.appendChild(wrapper);
        }

        tr.appendChild(td);
      }
      table.appendChild(tr);
    }

    function updateSuggestions(input, suggestionBox) {
  const val = input.value.trim();
  const currentUsed = Array.from(document.querySelectorAll("input")).map(i => i.value.trim());
  suggestionBox.innerHTML = "";

  wordList.forEach(word => {
    if (!currentUsed.includes(word) && word.includes(val)) {
      const div = document.createElement("div");
      div.textContent = word;
      suggestionBox.appendChild(div);
    }
  });

  suggestionBox.style.display = "block";
}

    function finalizeInput(input, td, val) {
      usedWords.add(val);
      if (rainbowWords.includes(val)) {
        td.style.background = "linear-gradient(135deg, #f4d7f4, #d6c6e1, #c0d4f7, #bde5c8, #fffabf, #ffe4b5, #f7b3b3)";
    } else if (roseWord.includes(val)) {
        td.style.background = "#c05d69";
      } else {
        td.style.background = "#ccc";
      }
    }

    function randomFill() {
  const inputs = Array.from(document.querySelectorAll("textarea"));
  const filled = new Set();
  
  // すでに入力済みのワードを把握してusedWordsに追加
  inputs.forEach(input => {
    const val = input.value.trim();
    if (val) {
      usedWords.add(val);
      filled.add(val);
    }
  });

  const available = wordList
    .filter(word => !usedWords.has(word))
    .sort(() => Math.random() - 0.5); // シャッフル

  let idx = 0;
  inputs.forEach(input => {
    if (input.value.trim()) return; // すでに入力済みならスキップ

    const val = available[idx++];
    if (!val) return;

    input.value = val;
    const td = input.closest("td");
    finalizeInput(input, td, val);
  });
}

    function resetBoard() {
      const inputs = document.querySelectorAll("textarea");
      inputs.forEach(input => {
        input.value = "";
        input.closest("td").style.background = "#ccc";
      });
      usedWords.clear();
    }
  </script>
</body>
</html>
