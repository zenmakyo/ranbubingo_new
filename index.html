<!DOCTYPE html>
<html lang="ja">
<head>
  <meta charset="UTF-8">
  <title>スマホ対応ビンゴ</title>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    body {
      font-family: sans-serif;
      text-align: center;
      padding: 10px;
      margin: 0;
      background-color: #d6e5b0; /* 畳色 */
      color: #333;
    }

    table {
      width: 90vw;
      max-width: 600px;
      margin: 0 auto;
      border-collapse: collapse;
      table-layout: fixed;
    }

    td {
      border: 2px solid #333;
      vertical-align: middle;
      position: relative;
      padding: 0;
    }

    .input-wrapper {
      width: 100%;
      height: 100%;
      padding: 4px;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      flex-direction: column;
      box-sizing: border-box;
      position: relative;
    }

    input.cellInput {
      width: 90%;
      min-height: 2em;
      font-size: clamp(14px, 3vw, 18px);
      text-align: center;
      border: 1px solid #ccc;
      border-radius: 6px;
      box-sizing: border-box;
    }

    .suggestions {
      position: absolute;
      top: 100%;
      left: 0;
      width: 100%;
      max-height: 120px;
      overflow-y: auto;
      background: white;
      border: 1px solid #ccc;
      z-index: 10;
      border-radius: 6px;
      display: none;
    }

    .suggestions div {
      padding: 6px;
      cursor: pointer;
      text-align: left;
    }

    .suggestions div:hover {
      background: #e0e0e0;
    }

    td.usedA {
      background-color: #90caf9;
    }

    td.usedB {
      background-color: #e0e0e0;
    }

    td.center-free {
      background-color: gold;
      font-size: 1.8em;
    }

    .button-row {
      margin-top: 20px;
      display: flex;
      justify-content: center;
      gap: 10px;
    }

    #randomBtn, #resetBtn {
      padding: 10px 20px;
      font-size: 1em;
      border-radius: 8px;
      border: none;
      cursor: pointer;
      color: white;
    }

    #randomBtn {
      background-color: #88a05f; /* 抹茶色 */
    }

    #randomBtn:hover {
      background-color: #7a9155;
    }

    #resetBtn {
      background-color: #c75b4a; /* 椿色 */
    }

    #resetBtn:hover {
      background-color: #b04e3f;
    }
  </style>
</head>
<body>
  <h2>スマホ対応ビンゴ</h2>

  <table id="bingo">
    <tbody></tbody>
  </table>

  <div class="button-row">
    <button id="randomBtn">ランダム配置</button>
    <button id="resetBtn">リセット</button>
  </div>

  <script>
    const words = [
      "りんご", "バナナ", "みかん", "ぶどう", "すいか", "もも", "パイナップル", "キウイ", "レモン", "メロン",
      "なし", "さくらんぼ", "グレープフルーツ", "ブルーベリー", "ストロベリー", "マンゴー", "ドリアン",
      "ライチ", "パッションフルーツ", "アボカド", "ラズベリー", "オレンジ", "ネーブル", "カキ", "イチジク"
    ];

    const specialWords = ["バナナ", "ぶどう", "すいか"];
    const usedWords = new Set();
    const inputs = [];

    const table = document.querySelector("#bingo tbody");

    for (let i = 0; i < 5; i++) {
      const tr = document.createElement("tr");
      for (let j = 0; j < 5; j++) {
        const td = document.createElement("td");

        if (i === 2 && j === 2) {
          td.className = "center-free";
          td.innerHTML = "⭐️";
          tr.appendChild(td);
          continue;
        }

        const wrapper = document.createElement("div");
        wrapper.className = "input-wrapper";

        const input = document.createElement("input");
        input.type = "text";
        input.className = "cellInput";
        input.placeholder = "未選択";

        const suggestionBox = document.createElement("div");
        suggestionBox.className = "suggestions";

        const updateSuggestions = () => {
          const value = input.value.trim();
          suggestionBox.innerHTML = "";

          const filtered = (value === "")
            ? words.filter(w => !usedWords.has(w))
            : words.filter(w => w.startsWith(value) && !usedWords.has(w));

          if (filtered.length === 0) {
            suggestionBox.style.display = "none";
            return;
          }

          filtered.forEach(word => {
            const div = document.createElement("div");
            div.textContent = word;
            div.addEventListener("click", () => {
              input.value = word;
              suggestionBox.style.display = "none";

              if (usedWords.has(word)) {
                alert("この単語はすでに使用されています");
                input.value = "";
                td.className = "";
                return;
              }

              td.className = specialWords.includes(word) ? "usedA" : "usedB";
              usedWords.add(word);
            });
            suggestionBox.appendChild(div);
          });

          suggestionBox.style.display = "block";
        };

        input.addEventListener("input", updateSuggestions);
        input.addEventListener("focus", updateSuggestions);
        input.addEventListener("blur", () => {
          setTimeout(() => {
            suggestionBox.style.display = "none";
          }, 200);
        });

        wrapper.appendChild(input);
        wrapper.appendChild(suggestionBox);
        td.appendChild(wrapper);
        tr.appendChild(td);

        inputs.push({ input, td });
      }
      table.appendChild(tr);
    }

    // ランダム配置
    document.getElementById("randomBtn").addEventListener("click", () => {
      const availableWords = words.filter(w => !usedWords.has(w));
      const emptyCells = inputs.filter(({ input }) => input.value === "");

      if (availableWords.length < emptyCells.length) {
        alert("単語が足りません！");
        return;
      }

      const shuffled = availableWords.sort(() => 0.5 - Math.random());

      emptyCells.forEach(({ input, td }, idx) => {
        const word = shuffled[idx];
        input.value = word;
        td.className = specialWords.includes(word) ? "usedA" : "usedB";
        usedWords.add(word);
      });
    });

    // リセット
    document.getElementById("resetBtn").addEventListener("click", () => {
      inputs.forEach(({ input, td }) => {
        input.value = "";
        td.className = "";
      });

      // 中央だけ戻す
      const centerTd = document.querySelector("td.center-free");
      if (centerTd) centerTd.innerHTML = "⭐️";

      usedWords.clear();
    });
  </script>
</body>
</html>
